<bs-container>
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ (query()?.description | resolveTranslation) || query()?.name || ('loading' | t) }}</h2>
    <div class="d-flex gap-2">
      @if (extraActionsTemplate(); as extraActionsTpl) {
        <ng-container *ngTemplateOutlet="extraActionsTpl"></ng-container>
      }
      @if (canCreate()) {
        <button class="btn btn-primary" (click)="onCreate()">
          <spark-icon name="plus-lg" /> {{ 'new' | t }}
        </button>
      }
    </div>
  </div>

  @if (entityType()) {
    <!-- Search box -->
    <bs-form>
      <bs-grid>
        <div bsRow class="mb-3">
          <div [md]="4">
            <bs-input-group>
              <span class="input-group-text">
                <spark-icon name="search" />
              </span>
              <input
                type="text"
                [placeholder]="'search' | t"
                [(ngModel)]="searchTerm"
                (ngModelChange)="onSearchChange()">
              @if (searchTerm) {
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="clearSearch()">
                  <spark-icon name="x-lg" />
                </button>
              }
            </bs-input-group>
          </div>
          <div [md]="8" class="text-end">
            @if (searchTerm && paginationData()) {
              <span class="text-muted">
                {{ paginationData()!.totalRecords }} {{ paginationData()!.totalRecords === 1 ? ('resultFound' | t) : ('resultsFound' | t) }}
              </span>
            }
          </div>
        </div>
      </bs-grid>
    </bs-form>

    @if (errorMessage(); as err) {
      <bs-alert [type]="colors.danger" class="mb-3">
        {{ err }}
      </bs-alert>
    }

    <bs-datatable [(settings)]="settings" (settingsChange)="onSettingsChange()">
      @for (attr of visibleAttributes(); track attr.id) {
        <div *bsDatatableColumn="attr.name; sortable: true">
          {{ (attr.label | resolveTranslation) || attr.name }}
        </div>
      }

      <tr *bsRowTemplate="let item of paginationData()" (click)="onRowClick(item)" style="cursor: pointer;">
        @for (attr of visibleAttributes(); track attr.id) {
          <td>
            @if (getColumnTemplate(attr); as customTpl) {
              <ng-container *ngTemplateOutlet="customTpl; context: getColumnTemplateContext(item, attr)"></ng-container>
            } @else if (attr.dataType === 'boolean') {
              <input type="checkbox"
                [checked]="(attr.name | attributeValue:item:entityType():lookupReferenceOptions():allEntityTypes()) === true"
                [indeterminate]="(attr.name | attributeValue:item:entityType():lookupReferenceOptions():allEntityTypes()) == null"
                disabled
                onclick="return false;">
            } @else {
              {{ (attr.name | attributeValue:item:entityType():lookupReferenceOptions():allEntityTypes()) }}
            }
          </td>
        }
      </tr>
    </bs-datatable>
  } @else {
    <div class="text-center p-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">{{ 'loading' | t }}</span>
      </div>
    </div>
  }
</div>
</bs-container>
