<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ query?.name || 'Loading...' }}</h2>
    @if (canCreate) {
      <button class="btn btn-primary" (click)="onCreate()">
        <app-icon name="plus-lg" /> New
      </button>
    }
  </div>

  @if (entityType) {
    <!-- Search box -->
    <bs-form>
      <div class="row mb-3">
        <div class="col-md-4">
          <bs-input-group>
            <span class="input-group-text">
              <app-icon name="search" />
            </span>
            <input
              type="text"
              placeholder="Search..."
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange()">
            @if (searchTerm) {
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="clearSearch()">
                <app-icon name="x-lg" />
              </button>
            }
          </bs-input-group>
        </div>
        <div class="col-md-8 text-end">
          @if (searchTerm && paginationData) {
            <span class="text-muted">
              {{ paginationData.totalRecords }} result{{ paginationData.totalRecords !== 1 ? 's' : '' }} found
            </span>
          }
        </div>
      </div>
    </bs-form>

    @if (errorMessage) {
      <bs-alert [type]="colors.danger" class="mb-3">
        {{ errorMessage }}
      </bs-alert>
    }

    <bs-datatable [(settings)]="settings" (settingsChange)="onSettingsChange()">
      @for (attr of getVisibleAttributes(); track attr.id) {
        <div *bsDatatableColumn="attr.name; sortable: true">
          {{ resolveTranslation(attr.label) || attr.name }}
        </div>
      }

      <tr *bsRowTemplate="let item of paginationData" (click)="onRowClick(item)" style="cursor: pointer;">
        @for (attr of getVisibleAttributes(); track attr.id) {
          <td>
            @if (attr.dataType === 'boolean') {
              <input type="checkbox"
                [checked]="getAttributeValue(item, attr.name) === true"
                [indeterminate]="getAttributeValue(item, attr.name) == null"
                disabled
                onclick="return false;">
            } @else {
              {{ getAttributeValue(item, attr.name) }}
            }
          </td>
        }
      </tr>
    </bs-datatable>
  } @else {
    <div class="text-center p-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }
</div>
